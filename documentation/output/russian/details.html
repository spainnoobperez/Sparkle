<!doctype html>
<html>
<head>
<title>Sparkle</title>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<h1>Sparkle</h1>
<div class="text">
<h2>Подробности</h2>

&nbsp;&nbsp;&nbsp;&nbsp;1. Sparkle создает сокет (файл) <span class="file">/data/data/com.sion.sparkle/files/wayland-0</span>. Если вы используете chroot, необходимо сделать этот файл доступным изнутри директории с дистрибутивом. Самый простой способ - это смонтировать <span class="file">/data</span> в директорию дистрибутива:<br>
<div class="code">
# в андроиде, от рута<br>
mkdir -p путь_к_директории_дистрибутива/data<br>
mount -o bind /data путь_к_директории_дистрибутива/data<br>
</div>
Но, если вы так сделаете, лучше бы вам об этом не забыть и не попытаться удалить дистрибутив командой<br>
<div class="code">
rm -rf<br>
</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;2. Wayland клиентам (включая xwayland) для работы нужна специальная директория (XDG_RUNTIME_DIR). Владельцем директории должен быть пользователь, который будет запускать клиент (не обязательно root). Лучше создать новую директорию на tmpfs. Если вы используете chroot, проверьте смонтировано ли у вас tmpfs на <span class="file">/tmp</span>. Если нет, смонтируйте:<br>
<div class="code">
# в дистрибутиве, от рута<br>
mount -t tmpfs tmpfs /tmp<br>
</div>
Затем создайте директорию от имени вашего основного пользователя (название не обязательно должно быть <span class="file">runtime</span>):<br>
<div class="code">
# в дистрибутиве, от пользователя<br>
mkdir /tmp/runtime<br>
</div>
Если клиент запускается в окружении андроида (без chroot), всё, в принципе, так же. Точкой монтирования tmpfs не обязательно должно быть <span class="file">/tmp</span>.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;3. Создайте симлинк на <span class="file">data/data/com.sion.sparkle/wayland-0</span> в вашей XDG_RUNTIME_DIR:<br>
<div class="code">
ln -s /data/data/com.sion.sparkle/files/wayland-0 /tmp/runtime/<br>
</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;4. Теперь нужно либо отключить SELinux:<br>
<div class="code">
# в андроиде, от рута<br>
setenforce 0<br>
</div>
либо изменить контекст на вашей XDG_RUNTIME_DIR. Есть три варианта. Сначала попробуйте такой:<br>
<div class="code">
# в андроиде, от рута<br>
restorecon путь_к_директории_дистрибутива/tmp<br>
restorecon путь_к_директории_дистрибутива/tmp/runtime<br>
</div>
Если не сработает, можно изменить контекст на вот такой:<br>
<div class="code">
# в андроиде, от рута<br>
chcon "u:object_r:app_data_file:s0" путь_к_директории_дистрибутива/tmp<br>
chcon "u:object_r:app_data_file:s0" путь_к_директории_дистрибутива/tmp/runtime<br>
</div>
А если и это не сработает, то можно посмотреть контекст на директории sparkle и установить для XDG_RUNTIME_DIR такой же:<br>
<div class="code">
# в андроиде, от рута<br>
ls -Z /data/data/com.sion.sparkle/files<br>
</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;5. Попробуйте запустить xwayland (или другой клиент):<br>
<div class="code">
export XDG_RUNTIME_DIR=/tmp/runtime<br>
Xwayland<br>
</div>
</div>
</body>
</html>
